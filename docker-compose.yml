# Production-ready Docker Compose for Petbot
# NOTE: Do NOT commit secrets or concrete ALLOWED_IMAGE_HOSTS values. Use an override file or `.env` for sensitive values.
version: "3.8"

services:
  petbot:
    container_name: petbot
    # Image to pull by default; will be used as the tag if you build locally
    image: "${IMAGE:-ghcr.io/rustedaperture/petbot:latest}"
    restart: unless-stopped
    working_dir: /home/node/app
    environment:
      # Example: ALLOWED_IMAGE_HOSTS is optional and should not be committed
      # - ALLOWED_IMAGE_HOSTS=example.com,images.example.net
    ports:
      - "3000:3000"
    volumes:
      # Persist runtime data (sqlite DB, migrations, etc.)
      - ./data:/home/node/app/data
      # Mount your config.json (read-only). Create it locally as documented in README.
      - ./config.json:/home/node/app/config.json:ro
    # The container will start both the bot and (if present) the Next.js server on port 3000.

volumes:
  data:
    driver: local

# Example: docker-compose.override.yml (keep out of VCS / do not commit values)
# services:
#   petbot:
#     environment:
#       - ALLOWED_IMAGE_HOSTS=example.com,images.example.net

# Quick commands:
# - Build locally:     docker compose build petbot
# - Run in foreground: docker compose up --build
# - After `docker compose up`, open the web UI at http://localhost:3000
